{% assign themes = "dark,light" | split: "," %}

<!-- model -->
{% assign model = include.model %}
{% if include.dalle %}{% assign model = "DALL·E " | append: include.dalle %}{% endif %}
{% if include.imagen %}{% assign model = "Imagen " | append: include.imagen %}{% endif %}

<!-- context url -->
{% if include.bard %}
{% assign context_url = "https://g.co/bard/share/" | append: include.bard %}
{% endif %}

<!-- for loop inspired by https://jekyllcodex.org/without-plugin/image-gallery/# -->
{% for file in site.static_files %}{% if file.path contains include.folder %}{% if
file.extname == '.webp' or file.extname == '.jpeg' or file.extname == '.png' or file.extname == '.jpg' %}{% assign
filenameparts = file.path | split: "/" %}{% assign filename = filenameparts | last | replace: file.extname,"" %}

<!-- id -->
{% assign id = filename | replace: "/","_" | replace: ".","_" | replace:" ","_" | replace:",","_" %}
<!-- snippet -->
{% assign snip = nil %}
{% if include.snip %}
{% assign snip = include.snip %}
{% endif %}
{% if include.snips == "auto" %}
{% assign snip = filename | replace: "_"," "%}
{% endif %}
{% if include.dalle %}
{% assign snip = filename
| regex_replace_once: "DALL·E (\d{4})-(\d{2})-(\d{2}) (\d{2}).(\d{2}).(\d{2}) - ",""
| replace:"_"," "
| append:"…"%}
{% endif %}

<div class="col">
    <figure class="">
        <img src="{{ site.url}}{{ file.path | relative_url }}" />
        {% for th in themes %}
        <figcaption class="{{th}} btn-group btn-group-sm w-100">
            {% assign b_clz = "text-secondary btn btn-sm btn-" | append: th %}
            <button class="{{b_clz}} text-start w-100 " data-bs-toggle="offcanvas"
                data-bs-target="#detail_{{id}}_{{th}}">
                <i class="fa-solid fa-bars-staggered"></i>
                <small>details</small>
            </button>
            {% if include.ref %}
            <span class="{{b_clz}} text-end w-100">
                <small>#{{include.ref}}</small>
            </span>
            {% endif %}
            <a class="{{b_clz}} text-end" href="{{ file.path | relative_url }}" target="_blank">
                {% if include.href %}
                <i class="fa-solid fa-up-right-from-square"></i>
                {% else %}
                <i class="fa-solid fa-image"></i>
                {% endif %}
            </a>
        </figcaption>
        <div class="{{th}} offcanvas offcanvas-end" data-bs-backdrop="true" data-bs-scroll="true" data-bs-theme="{{th}}"
            tabindex="-1" id="detail_{{id}}_{{th}}">
            <div class="offcanvas-header">
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body text-secondary">
                <img src="{{ site.url}}{{ file.path | relative_url }}" width="200" class="img-thumbnail" />
                {% if model %}
                <p class="p-2 border-top border-bottom border-secondary-subtle bg-{{th}}-subtle">
                    <i class="fa-solid fa-microchip"></i>
                    <b>model:</b> <span>{{model}}</span>
                    {% if include.href %}
                    <a href="{{ file.path | relative_url }}" target="_blank" class="badge text-reset border-bottom-0">
                        <i class="fa-solid fa-up-right-from-square"></i>
                    </a>
                    {% endif %}
                </p>
                {% endif %}
                {% assign phclz = "m-0 p-2 bg-body-secondary" %}
                {% assign p_clz = "px-2 py-1 border-bottom border-secondary-subtle
                bg-_TH_-subtle" | replace: "_TH_", th %}
                <!-- snippet -->
                {% if snip %}
                <div>
                    <h5 class="{{phclz}}"><i class="fa-solid fa-wand-magic-sparkles pe-1"></i>
                        prompt snippet
                    </h5>
                    <p class="{{p_clz}}">{{ snip}}</p>
                </div>
                {% endif %}
                <!-- snippet -->
                {% if context_url %}
                <div>
                    <h5 class="{{phclz}}"><i class="fa-solid fa-wand-magic-sparkles pe-1"></i>
                        context
                    </h5>
                    <p class="{{p_clz}}"> <a target="_blank" href="{{context_url}}">{{context_url}}</a> </p>
                </div>
                {% endif %}
                <!-- prompt -->
                {% if include.prompt %}
                <div>
                    <h5 class="{{phclz}}"><i class="fa-solid fa-hat-wizard pe-1"></i>
                        prompt
                    </h5>
                    <p class="{{p_clz}}">{{include.prompt}}</p>
                </div>
                {% endif %}
                <!-- notes -->
                {% if include.notes %}
                <div>
                    <h5 class="{{phclz}}"><i class="fa-solid fa-feather-pointed pe-1"></i>
                        notes
                    </h5>
                    <p class="{{p_clz}}">{{include.notes}}</p>
                </div>
                {% endif %}
                <!-- instruct -->
                {% if include.chat_gpt %}
                <div>
                    <h5 class="{{phclz}}"> <i class="fa-solid fa-ghost pe-1"></i>
                        prompt generated by ChatGPT
                    </h5>
                    <p class="{{p_clz}}">{{include.chat_gpt}}</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </figure>
</div>

{% endif %}{% endif %}{% endfor %}